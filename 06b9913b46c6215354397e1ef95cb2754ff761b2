{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ce2746df_d8163ef0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 14,
      "author": {
        "id": 1470474
      },
      "writtenOn": "2023-08-03T16:30:06Z",
      "side": 1,
      "message": "what is MMP playback?",
      "range": {
        "startLine": 14,
        "startChar": 0,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "06b9913b46c6215354397e1ef95cb2754ff761b2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c554ce9_1563ebdc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 14,
      "author": {
        "id": 1659435
      },
      "writtenOn": "2023-08-03T16:46:05Z",
      "side": 1,
      "message": "MMP player - a multimedia player app I guess",
      "parentUuid": "ce2746df_d8163ef0",
      "range": {
        "startLine": 14,
        "startChar": 0,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "06b9913b46c6215354397e1ef95cb2754ff761b2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5bb82bf_1cf69b78",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 14,
      "author": {
        "id": 1837035
      },
      "writtenOn": "2023-08-09T07:28:36Z",
      "side": 1,
      "message": "Yes",
      "parentUuid": "3c554ce9_1563ebdc",
      "range": {
        "startLine": 14,
        "startChar": 0,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "06b9913b46c6215354397e1ef95cb2754ff761b2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5878fac2_0b7821be",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 14,
      "author": {
        "id": 1659435
      },
      "writtenOn": "2023-08-09T09:16:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f5bb82bf_1cf69b78",
      "range": {
        "startLine": 14,
        "startChar": 0,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "06b9913b46c6215354397e1ef95cb2754ff761b2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a834df47_d7e99fcc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1010103
      },
      "writtenOn": "2023-08-09T14:30:46Z",
      "side": 1,
      "message": "I think this makes sense, but a unit test that validates this is required to be added to `libs/gui/tests` in order to accept this change.",
      "revId": "06b9913b46c6215354397e1ef95cb2754ff761b2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1fbf48bd_170a4a86",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1837035
      },
      "writtenOn": "2023-10-19T03:22:41Z",
      "side": 1,
      "message": "After a lot of tests, it seams that there is a side effect of this patch.\nFor tunneled playback, if we would like to keep video freeze on Surface after closing MediaCodec.\nThis patch may violate this behavior, because there will be a sideband change notification to let SF switch from sideband to non-sideband.\nAnd this destroys the hw render engine in HWC.\n\nSo, we would like to change the patch from BufferQueue to CCodec.\nFor KEY_PUSH_BLANK_BUFFERS_ON_STOP case,\n  CCodec should setSidebandStream(nullptr) and then push blank video.\nFor no KEY_PUSH_BLANK_BUFFERS_ON_STOP case,\n  CCodec should not setSidebandStream(nullptr) and not push blank video.\n\nBecause we have some applications need to implement seamless feature, it means video should keep display on screen while MediaCodec changes with the same surface in tunneled playback.\n\nFor case: MediaCodec1 (tunnel) with Surface1 -\u003e MediaCodec1 close -\u003e MediaCodec2 (tunnel) with Surface1\nThere is also a tricky point that \u0027KEY_PUSH_BLANK_BUFFERS_ON_STOP \u003d false\u0027 means video should freeze after MediaCodec closes.\nBut currently, MediaCodec closing causes BufferQueue::disconnect() which sets sidebandStream handle to nullptr.\nAlthough this sidebandStream state doesn\u0027t update to SF immediately without the MTK patch.\nWe think if it is possible that there is a way not to set sidebandStream to nullptr in BufferQueue::disconnect while KEY_PUSH_BLANK_BUFFERS_ON_STOP  \u003d false.\nSo, we can keep sideband video show on screen and then switch to next sideband handle seamlessly.",
      "revId": "06b9913b46c6215354397e1ef95cb2754ff761b2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "86593046_16f97070",
        "filename": "libs/gui/BufferQueueProducer.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1393,
      "author": {
        "id": 1470474
      },
      "writtenOn": "2023-08-03T16:30:06Z",
      "side": 1,
      "message": "why is this change needed? shouldn\u0027t the producer side know that there\u0027s no longer a sidebadn stream upon disconnecting?",
      "range": {
        "startLine": 1392,
        "startChar": 8,
        "endLine": 1393,
        "endChar": 48
      },
      "revId": "06b9913b46c6215354397e1ef95cb2754ff761b2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02bae666_f50c92d0",
        "filename": "libs/gui/BufferQueueProducer.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1393,
      "author": {
        "id": 1837035
      },
      "writtenOn": "2023-08-09T04:30:00Z",
      "side": 1,
      "message": "Hi Google, Producer is Codec2 under MediaCodec. Once MediaCodec is closed and disconnect from BufferQueue, but SurfaceView still exits and appears on the screen. Yes, producer know BufferQueue is disconnected but SurfaceView/BlastBufferQueue doesn\u0027t know. If Apk sets KEY_PUSH_BLANK_BUFFERS_ON_STOP to MediaCodec, MediaCodec will push blank graphic buffer into BufferQueue after MediaCodec is closed. So, SurfaceFlinger/HWC side will change from [1]SIDEBAND to [2]CLIENT(blank graphic buffer) and then [3]SIDEBAND. And we would like to avoid [3] from happening to cause abnormal behaviors for our HW display path. So, we need to add this solution to let SurfaceView/BlastBufferQueue/Layer/SurfaceFlinger know that this layer is no longer a sideband layer.\n\nThanks",
      "parentUuid": "86593046_16f97070",
      "range": {
        "startLine": 1392,
        "startChar": 8,
        "endLine": 1393,
        "endChar": 48
      },
      "revId": "06b9913b46c6215354397e1ef95cb2754ff761b2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}